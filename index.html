<!DOCTYPE html>
<html>
  <head>
    <meta name="viewport" content="initial-scale=1.0, user-scalable=no"/>
    <script type="text/javascript" src="http://maps.google.com/maps/api/js?sensor=true"></script>
    <script type="text/javascript" src="http://mbostock.github.com/d3/d3.js?1.29.1"></script>
    <style type="text/css">

      html, body, #map {
        width: 500px;
        height: 500px;
        margin: 0;
        padding: 0;
      }

    </style>
  </head>
  <body>
    <div id="map"></div>
    <script src="./Path demonstration_files/pathlayout.js"></script>
    <script type="text/javascript">

      // Create the Google Map…
      var map = new google.maps.Map(d3.select("#map").node(), {
        zoom:10,
        center: new google.maps.LatLng(21.386473, 39.438679),
        mapTypeId: google.maps.MapTypeId.TERRAIN
      });

      // Load the station data. When the data comes back, create an overlay.
      // d3.json("stations.json", function(data) {
      var overlay = new google.maps.OverlayView();

      var route = []

      d3.json("google_directions_api_response.json", function(error, data) {

          steps = data['routes'][0]['legs']['steps'];
          number_steps = range(len(steps));
          number_steps.forEach(function(i){
            route.push({'i':i, "start":steps[i]['start_location'], "end":steps[i]['end_location']})
          });
      });

      // Add the container when the overlay is added to the map.
      overlay.onAdd = function() {
          var layer = d3.select(this.getPanes().overlayLayer).append("svg")
              .attr("id", "main")
              .attr("width",500)
              .attr("height",500);

          // Draw each marker as a separate SVG element.
          // We could use a single SVG, but what size would it have?
          overlay.draw = function() {
              //TRAIL CODE STARTS
            var data = [{"x":0,"y":0,"i":0}]

            d3.range(1000).forEach(function(i) {
              data.push({"i":i+1,
              "x":data[data.length-1]["x"]+(Math.random())-.5,
              "y":data[data.length-1]["y"]+(Math.random())-.5})
            })


            //Build x and y scales appropriate to it.
            x = d3.scale.linear().range([0,500]).domain(d3.extent(data.map(function(d)  {return d.x}))) 
            y = d3.scale.linear().range([0,500]).domain(d3.extent(data.map(function(d)  {return d.y})))


            layout = d3.layout.trail() 

            layout = layout 
                .positioner(function(d) {return [x(d['x']),y(d['y'])]}) 
                .coordType("xy")
            .sort(function(a,b) {return a.i-b.i})

            var out = layout.data(data).layout()

            var line = d3.select("#main").selectAll("line").data(out)

            line
              .enter()
              .append("line")
              .style("stroke-width",3)
              .style("stroke","orange")
              .style("opacity",1) 
              .attr("x0",function(d) {return d['x0']})
              .attr("x1",function(d) {return d.x1}) 
              .attr("y1",function(d) {return d.y1}) 
              .attr("y2",function(d) {return d.y1}) 
              .attr("x2",function(d) {return d.x1})
              .transition() 
              .delay(function(d,i)   {return i*100})               
              .attr("y2",function(d) {return d.y2}) 
              .attr("x2",function(d) {return d.x2})
              .transition()
              .duration(1000)
              .style("opacity",0.2)
              // .remove()

            //TRAIL CODE ENDS
          };
        };

        

        // Bind our overlay to the map…
        overlay.setMap(map);
      // });

    </script>
  </body>
</html>